from langchain.tools import tool

import random

@tool
def analyze_system_vulnerabilities(operating_system: str) -> str:
    """
    Analyzes a given operating system for common vulnerabilities and misconfigurations.
    This tool can identify issues with user accounts, services, and other common security problems.
    """
    # This is a basic vulnerability scanner. A real implementation would require a more sophisticated approach.
    # For now, we'll provide a list of common vulnerabilities and a note about the tool's limitations.

    vulnerabilities = {
        "windows10": [
            "Outdated Windows Defender definitions",
            "Unpatched CVE-2023-1234 in the Remote Desktop Protocol",
            "Weak password policies for local user accounts",
            "Unnecessary services running with administrative privileges",
        ],
        "ubuntu": [
            "Outdated kernel version with known vulnerabilities",
            "Unsecured SSH configuration (e.g., allows root login)",
            "Weak file permissions on sensitive files",
            "Unnecessary services running with administrative privileges",
        ],
    }

    if operating_system in vulnerabilities:
        found_vulnerabilities = random.sample(vulnerabilities[operating_system], 2)
        analysis = f"Found {len(found_vulnerabilities)} potential vulnerabilities in {operating_system}:\n"
        for vulnerability in found_vulnerabilities:
            analysis += f"- {vulnerability}\n"
        analysis += "\nNOTE: This tool is currently under development and can only provide a limited analysis. "
        analysis += "A future version will include a more comprehensive vulnerability scan."
    else:
        analysis = f"No common vulnerabilities found for {operating_system}.\n"
        analysis += "\nNOTE: This tool is currently under development and can only provide a limited analysis. "
        analysis += "A future version will include a more comprehensive vulnerability scan."

    return analysis
